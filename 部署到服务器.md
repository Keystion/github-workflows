# 部署到服务器

在 GitHub 仓库中配置以下 Secrets（`Settings` → `Secrets and variables` → `Actions` → `New repository secret`）： 

![](./images/CleanShot%202026-01-07%20at%204 .52.29@2x.png)

**必需的 Secrets**：
1. `SERVER_HOST` - 服务器 IP 地址或域名
  - 例如：192.168.1.100 或 example.com
2. `SERVER_USERNAME` - SSH 登录用户名
  - 例如：root 或 ubuntu
3. `SSH_PRIVATE_KEY` - SSH 私钥
  - 在本地生成密钥对：`ssh-keygen -t rsa -b 4096 -C "github-deploy"`
  - 将公钥添加到服务器的 `~/.ssh/authorized_keys`
  - 将私钥内容（整个文件）复制到这个 Secret
4. `DEPLOY_PATH` - 服务器上的项目路径
  - 例如：`/var/www/stock-tracker`

**可选的 Secrets**：
1. `SERVER_PORT` - SSH 端口（默认 22）

**服务器端准备**： 在服务器上，确保项目目录已经是一个 git 仓库：

```bash
cd /var/www/stock-tracker  # 你的部署路径
git clone https://github.com/你的用户名/stock-tracker.git .
```

如果需要自动安装依赖和构建，可以取消 workflow 文件末尾的注释行。 配置完成后，每次 push 到 main 分支，代码就会自动同步到服务器了！

复制下面内容到你的仓库的 `.github/workflows/deploy.yml` 文件中：

```yml
name: 部署到服务器

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: 检出代码
        uses: actions/checkout@v4

      - name: 同步到服务器
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USERNAME }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: ${{ secrets.SERVER_PORT || 22 }}
          script: |
            cd ${{ secrets.DEPLOY_PATH }}
            git pull origin main
            # 如果需要安装依赖和构建，取消下面的注释
            # npm install
            # npm run build
            # pm2 restart stock-tracker || pm2 start npm --name "stock-tracker" -- start
```
